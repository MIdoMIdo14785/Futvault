<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FUTVault — Price list</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#071025; --bg2:#061226;
    --card:#0b1724; --muted:#9aa4bf; --text:#e6eef9;
    --primary:#a8d4ff; --secondary:#cfe6df;
    --soft:#0f1b26;
    --radius:14px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text)}
  .wrap{max-width:1180px;margin:28px auto;padding:18px}
  header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
  .logo{width:58px;height:58px;border-radius:12px;overflow:hidden;background:linear-gradient(135deg,#0b74ff,#00c6ff);display:flex;align-items:center;justify-content:center;flex-shrink:0}
  .logo img{width:86%;height:86%;object-fit:cover;transform:scale(0.95)}
  h1{margin:0;font-size:20px}
  .lead{color:var(--muted);font-size:13px;margin-top:4px}
  .controls{display:flex;gap:12px;margin:18px 0;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .search{flex:1;display:flex;gap:8px;min-width:260px}
  input.searchbox{
    flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);
    background:rgba(255,255,255,0.02);color:var(--text);box-shadow:0 4px 12px rgba(2,6,12,0.35);min-width:220px
  }
  select.platform{padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);border:none;color:var(--text)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:22px;margin-top:18px;align-items:start}
  .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(2,6,12,0.6);display:flex;flex-direction:column;gap:12px;min-height:520px;overflow:visible}
  .cover{width:100%;height:320px;border-radius:10px;background:linear-gradient(180deg,#021024,#02101a);display:flex;align-items:center;justify-content:center;overflow:hidden}
  .cover img{width:100%;height:100%;object-fit:cover;border-radius:8px}
  .title{font-weight:700;font-size:16px;margin-top:6px}
  .durations{display:flex;gap:8px;justify-content:center;margin:4px 0}
  .durations button{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);cursor:pointer}
  /* ---------- FIX PRICES LAYOUT ---------- */
  .plat{
    background:var(--soft);
    border-radius:12px;
    padding:18px 14px;
    width: 100%;
    max-width: 240px;
    min-width: 160px;
    box-sizing: border-box;
    text-align:center;
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    justify-content:center;
    margin: 0 auto;
    position: relative;
  }
  .prices{
    display:flex;
    gap:14px;
    align-items:center;
    justify-content:center;
    flex-wrap:nowrap;
    width:100%;
    box-sizing:border-box;
  }
  .price{
    display:inline-block;
    padding:12px 18px;
    border-radius:12px;
    background:var(--primary);
    color:#072033;
    font-weight:700;
    min-width:110px;
    max-width:100%;
    box-sizing:border-box;
    text-align:center;
    white-space:nowrap;
  }
  .price.secondary{ background:var(--secondary); color:#072033; }
  .pssingle{ max-width:240px; margin: 0 auto; }
  .plat h4{margin:0;font-size:14px;color:var(--muted)}
  .label{font-size:13px;color:var(--muted);margin-top:6px}
  .ps-single-stack{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}
  @media(max-width:520px){
    .cover{height:220px}
    .plat{ max-width: 100%; min-width: 120px; padding:12px }
    .price{ min-width:90px; padding:10px 12px }
    .prices{ gap:8px }
    .grid{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  }
  :root.light{--bg1:#e9f2f4;--bg2:#e6eef3;--card:#ffffff;--soft:#f6f7f9;--text:#0b1724;--muted:#6b7380}
  .error{color:#ff6b6b;font-weight:700}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"><img src="assets/logo.png" alt="FUTVault logo" id="siteLogo" onerror="this.style.display='none'"></div>
      <div>
        <h1>FUTVault — Price list</h1>
        <div class="lead" id="leadText">Catalogue professionnel</div>
      </div>
      <div style="flex:1"></div>
      <div style="display:flex;gap:12px;align-items:center">
        <button id="modeToggle" style="padding:8px 12px;border-radius:12px;border:none;background:rgba(255,255,255,0.02);color:var(--text);cursor:pointer">Mode clair</button>
      </div>
    </header>

    <div class="controls">
      <div class="search">
        <input id="searchInput" class="searchbox" placeholder="Rechercher (titre, SKU, keywords)..." />
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="platformFilter" class="platform">
          <option value="all">Toutes plateformes</option>
          <option value="ps5">PS5</option>
          <option value="ps4">PS4</option>
        </select>
      </div>
    </div>

    <div id="message" style="margin-top:6px"></div>
    <div id="grid" class="grid"></div>
  </div>

<script>
(async function(){
  const grid = document.getElementById('grid');
  const msg = document.getElementById('message');
  const search = document.getElementById('searchInput');
  const filter = document.getElementById('platformFilter');
  const modeBtn = document.getElementById('modeToggle');
  let data = [], duration = '12m';

  try{
    const res = await fetch('data/games.json', {cache: "no-store"});
    if(!res.ok) throw new Error('JSON fetch failed: ' + res.status);
    data = await res.json();
  } catch(e){
    msg.innerHTML = '<div class="error">Erreur chargement data</div>';
    console.error(e);
    return;
  }

  function formatPrice(v){
    if(v === undefined || v === null || v === '-') return '-';
    return (typeof v === 'number' ? `${v} DHS` : v);
  }

  function createPriceElement(value, isSecondary=false){
    const el = document.createElement('div');
    el.className = 'price' + (isSecondary ? ' secondary' : '');
    el.textContent = formatPrice(value);
    el.style.minWidth = '110px';
    el.style.boxSizing = 'border-box';
    el.style.textAlign = 'center';
    return el;
  }

  function buildSubscriptionBox(label, obj){
    const box = document.createElement('div'); box.className='plat';
    const h = document.createElement('h4'); h.textContent = label; box.appendChild(h);

    let primary = '-';
    if(obj && obj.principal && obj.principal[duration] !== undefined) primary = obj.principal[duration];
    let secondary = '-';
    if(obj && obj.secondaire && obj.secondaire[duration] !== undefined) secondary = obj.secondaire[duration];

    // For subscriptions, we show primary and secondary side-by-side if both exist; otherwise hide secondary
    const pricesRow = document.createElement('div'); pricesRow.className = 'prices';

    const primWrap = document.createElement('div');
    primWrap.style.display = 'flex';
    primWrap.style.flexDirection = 'column';
    primWrap.style.alignItems = 'center';
    primWrap.style.gap = '6px';
    const primaryEl = createPriceElement(primary, false);
    const l1 = document.createElement('div'); l1.className='label'; l1.textContent='Principal';
    primWrap.appendChild(primaryEl); primWrap.appendChild(l1);

    const secWrap = document.createElement('div');
    secWrap.style.display = 'flex';
    secWrap.style.flexDirection = 'column';
    secWrap.style.alignItems = 'center';
    secWrap.style.gap = '6px';
    const secondaryEl = createPriceElement(secondary, true);
    const l2 = document.createElement('div'); l2.className='label'; l2.textContent='Secondaire';
    secWrap.appendChild(secondaryEl); secWrap.appendChild(l2);

    pricesRow.appendChild(primWrap);
    pricesRow.appendChild(secWrap);
    box.appendChild(pricesRow);

    if(secondary === '-' || secondary === null){ secondaryEl.style.visibility='hidden'; l2.style.visibility='hidden'; }

    return box;
  }

  function buildGameBoxSingle(label, obj){
    const box = document.createElement('div'); box.className='plat pssingle';
    const h = document.createElement('h4'); h.textContent = label; box.appendChild(h);

    // primary
    let primary = (obj && obj.principal !== undefined) ? obj.principal : '-';
    const primWrap = document.createElement('div');
    primWrap.style.display = 'flex';
    primWrap.style.flexDirection = 'column';
    primWrap.style.alignItems = 'center';
    primWrap.style.gap = '6px';
    const primaryEl = createPriceElement(primary, false);
    const l1 = document.createElement('div'); l1.className='label'; l1.textContent='Principal';
    primWrap.appendChild(primaryEl); primWrap.appendChild(l1);

    // secondary (stacked below)
    let secondary = (obj && obj.secondaire !== undefined) ? obj.secondaire : '-';
    const secWrap = document.createElement('div');
    secWrap.style.display = 'flex';
    secWrap.style.flexDirection = 'column';
    secWrap.style.alignItems = 'center';
    secWrap.style.gap = '6px';
    const secondaryEl = createPriceElement(secondary, true);
    const l2 = document.createElement('div'); l2.className='label'; l2.textContent='Secondaire';
    secWrap.appendChild(secondaryEl); secWrap.appendChild(l2);

    const container = document.createElement('div'); container.className='ps-single-stack';
    container.appendChild(primWrap);
    container.appendChild(secWrap);

    box.appendChild(container);

    if(secondary === '-' || secondary === null){ secondaryEl.style.visibility='hidden'; l2.style.visibility='hidden'; }

    return box;
  }

  function buildGameBoxSide(labelLeft, leftObj, labelRight, rightObj){
    // create a wrapper that looks like two plat boxes horizontally for consistent visual when both platforms exist
    const wrapper = document.createElement('div');
    wrapper.style.display = 'flex';
    wrapper.style.gap = '12px';
    wrapper.style.justifyContent = 'center';
    wrapper.style.width = '100%';

    const left = buildGameBoxSingle(labelLeft, leftObj);
    const right = buildGameBoxSingle(labelRight, rightObj);
    wrapper.appendChild(left);
    wrapper.appendChild(right);
    return wrapper;
  }

  function buildCard(item){
    const card = document.createElement('div'); card.className = 'card';

    const cover = document.createElement('div'); cover.className='cover';
    const img = document.createElement('img');
    img.src = item.image || 'assets/placeholder-1200.webp';
    img.alt = item.name;
    img.onerror = function(){ this.src = 'assets/placeholder-1200.webp'; }
    cover.appendChild(img);
    card.appendChild(cover);

    const title = document.createElement('div'); title.className='title'; title.textContent = item.name;
    card.appendChild(title);

    const durWrap = document.createElement('div'); durWrap.className='durations';
    if(item.category === 'subscription'){
      const b6 = document.createElement('button'); b6.textContent='6 mois';
      const b12 = document.createElement('button'); b12.textContent='12 mois';
      b6.onclick = ()=>{ duration='6m'; render(); };
      b12.onclick = ()=>{ duration='12m'; render(); };
      durWrap.appendChild(b6); durWrap.appendChild(b12);
      card.appendChild(durWrap);
    } else {
      const spacer = document.createElement('div'); spacer.style.height='6px'; card.appendChild(spacer);
    }

    const platformsWrap = document.createElement('div'); platformsWrap.className='platforms';

    if(item.category === 'subscription'){
      const ps5 = item.prices.ps5 || {};
      const ps4 = item.prices.ps4 || {};
      platformsWrap.appendChild(buildSubscriptionBox('PS5', ps5));
      platformsWrap.appendChild(buildSubscriptionBox('PS4', ps4));
    } else {
      const hasPs5 = item.platforms && item.platforms.ps5;
      const hasPs4 = item.platforms && item.platforms.ps4;
      if(hasPs5 && hasPs4){
        // side-by-side two plat boxes
        platformsWrap.appendChild(buildGameBoxSide('PS5', item.platforms.ps5, 'PS4', item.platforms.ps4));
      } else if(hasPs5){
        const b = buildGameBoxSingle('PS5', item.platforms.ps5);
        platformsWrap.appendChild(b);
      } else if(hasPs4){
        const b = buildGameBoxSingle('PS4', item.platforms.ps4);
        platformsWrap.appendChild(b);
      } else {
        const none = document.createElement('div'); none.textContent='No platform info'; none.style.color = 'var(--muted)'; platformsWrap.appendChild(none);
      }
    }

    card.appendChild(platformsWrap);
    return card;
  }

  function render(){
    grid.innerHTML = '';
    msg.innerHTML = '';
    const q = search.value.trim().toLowerCase();
    const platFilter = filter.value;
    let shown = 0;

    for(const item of data){
      if(platFilter !== 'all'){
        if(item.category === 'subscription'){
          if(!item.prices || !item.prices[platFilter]) continue;
        } else {
          if(!item.platforms || !item.platforms[platFilter]) continue;
        }
      }

      if(q){
        const inName = item.name && item.name.toLowerCase().includes(q);
        const inId = item.id && item.id.toLowerCase().includes(q);
        const insideKeywords = (item.keywords || []).join(' ').toLowerCase().includes(q);
        if(!(inName || inId || insideKeywords)) continue;
      }

      const card = buildCard(item);
      grid.appendChild(card);
      shown++;
    }

    if(shown === 0) msg.innerHTML = '<div class="error">Aucun résultat</div>';
  }

  render();

  search.addEventListener('input', ()=>render());
  filter.addEventListener('change', ()=>render());

  modeBtn.addEventListener('click', ()=>{
    document.documentElement.classList.toggle('light');
    const isLight = document.documentElement.classList.contains('light');
    modeBtn.textContent = isLight ? 'Mode nuit' : 'Mode clair';
  });

})();
</script>
</body>
</html>
